<style>
  #piezas_table .btn {
    box-shadow: none !important;
  }

  #piezas_table td {
    cursor: pointer !important;
  }

  .modal {
    z-index: 20;
  }

  .modal-backdrop {
    z-index: 10;
  }
</style>
<link rel="stylesheet" href="/public/assets/vendor/css/pages/app-chat.css" />

<div class="container-xxl flex-grow-1 container-p-y">
  <div class="d-flex justify-content-between align-items-center pb-2 border-bottom">
    <div class="d-flex align-items-center gap-2">
      <h4 class="mb-0">
        <span class="text-muted fw-light"><a class="text-muted" href="/clientes">Clientes</a> /</span>
        <span id="client_name_title"> <%= clientData.nombre %> </span>
      </h4>
      <!-- <span id="client-status"
				class="badge <%= clientData.meta?.status === 'archived' ?  'bg-label-warning' : 'bg-label-success' %>">
				<%= clientData.meta?.status=="archived" ? "Archivado" : "Activo" %>
			</span> -->
    </div>

    <div>
      <button
        class="btn btn-label-primary dropdown-toggle"
        type="button"
        id="dropdownMenuButton"
        data-bs-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false">
        Opciones
      </button>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
        <li>
          <a
            id="edit_client"
            data-bs-toggle="modal"
            data-bs-target="#modal_edit_client"
            class="dropdown-item d-flex align-items-center gap-2"
            href="javascript:void(0);"
            ><i class="ti ti-edit ti-xs me-1"></i>Editar</a
          >
        </li>
        <li>
          <a
            id="deleteClient"
            class="dropdown-item d-flex align-items-center gap-2"
            href="javascript:void(0);"
            data-bs-toggle="modal"
            data-bs-target="#delete_client_modal"
            ><i class="ti ti-trash-x ti-xs me-1"></i>Eliminar</a
          >
        </li>
      </ul>
    </div>
  </div>

  <div class="row pt-3">
    <!-- User Sidebar -->
    <div class="col-xl-4 col-lg-5 col-md-5 order-1 order-md-0">
      <!-- User Card -->
      <div class="card mb-4">
        <div class="card-body">
          <p class="small text-uppercase text-muted mb-0">Detalles</p>
          <div class="info-container pt-2">
            <ul class="list-unstyled">
              <li class="mb-2">
                <span class="fw-medium me-1">Nombre:</span>
                <span id="details_client_name"> <%= clientData.nombre %> </span>
              </li>
              <li class="mb-2">
                <span class="fw-medium me-1">Identificador:</span>
                <span id="details_client_rfc">
                  <%= clientData.identificador ? clientData.identificador : "No asignado" %>
                </span>
              </li>
              <li class="mb-2 pt-1">
                <span class="fw-medium me-1">Domicilio:</span>
                <span id="details_client_adress"> <%= clientData.domicilio %> </span>
              </li>
              <li class="mb-2 pt-1">
                <span class="fw-medium me-1">Estado:</span>
                <span id="details_client_state"> <%= clientData.estado ? clientData.estado : "No asignado" %> </span>
              </li>
              <li class="mb-2 pt-1">
                <span class="fw-medium me-1">Ciudad:</span>
                <span id="details_client_city"> <%= clientData.ciudad ? clientData.ciudad: "No asignado" %> </span>
              </li>
              <li class="mb-2 pt-1">
                <span class="fw-medium me-1">Teléfono:</span>
                <span id="details_client_phone">
                  <%= clientData.telefono ? clientData.telefono : "No asignado" %>
                </span>
              </li>
              <li class="mb-2 pt-1">
                <span class="fw-medium me-1">Celular:</span>
                <span id="details_client_cellphone">
                  <%= clientData.celular ? clientData.celular : "No asignado" %>
                </span>
              </li>
              <li class="mb-2 pt-1">
                <span class="fw-medium me-1">Correo:</span>
                <span id="details_client_mail"> <%= clientData.correo ? clientData.correo : "No asignado" %> </span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-8 col-lg-7 col-md-7 order-0 order-md-1">
      <div class="card">
        <div class="card-header pt-1">
          <ul class="nav nav-tabs card-header-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                type="button"
                class="nav-link active"
                role="tab"
                data-bs-toggle="tab"
                data-bs-target="#navs_catalogo"
                aria-controls="navs_catalogo"
                aria-selected="true">
                <i class="ti ti-device-imac ti-xs me-1"></i>
                Catálogo
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                type="button"
                class="nav-link"
                role="tab"
                data-bs-toggle="tab"
                data-bs-target="#navs_historial"
                aria-controls="navs_historial"
                aria-selected="false"
                tabindex="-1">
                <i class="ti ti-clock ti-xs me-1"></i>
                Historial
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                type="button"
                class="nav-link"
                role="tab"
                data-bs-toggle="tab"
                data-bs-target="#navs_stats"
                aria-controls="navs_stats"
                aria-selected="false"
                tabindex="-1">
                <i class="ti ti-chart-area ti-xs me-1"></i>
                Estadísticas
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                type="button"
                class="nav-link"
                role="tab"
                data-bs-toggle="tab"
                data-bs-target="#navs_settings"
                aria-controls="navs_settings"
                aria-selected="false"
                tabindex="-1">
                <i class="ti ti-settings ti-xs me-1"></i>
                Configuración
              </button>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content p-0 pt-3">
            <div class="tab-pane fade show active" id="navs_catalogo" role="tabpanel">
              <div class="row">
                <div class="col-md-6">
                  <div class="d-flex justify-content-between align-items-center gap-2">
                    <div class="flex-grow-1">
                      <input id="search_equipment" class="form-control" type="search" placeholder="Buscar pieza ..." />
                    </div>
                    <button type="button" class="btn btn-icon me-2 btn-label-primary waves-effect">
                      <span class="ti ti-filter"></span>
                    </button>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="d-flex justify-content-end align-items-center">
                    <button
                      type="button"
                      class="btn btn-primary waves-effect waves-light"
                      data-bs-toggle="modal"
                      data-bs-target="#modal_crear_pieza">
                      <span class="tf-icons ti-xs ti ti-plus me-1"></span>Nuevo
                    </button>
                  </div>
                </div>
              </div>
              <div class="table-responsive border-top mt-3">
                <!--TABLE HERE-->
                <div id="clientes_table_wrapper" class="dataTables_wrapper dt-bootstrap5 no-footer">
                  <table id="piezas_table" class="table table-striped w-100 table-hover"></table>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="navs_historial" role="tabpanel">
              <ul class="timeline mb-0 pt-2">
                <li class="timeline-item timeline-item-transparent">
                  <span class="timeline-point timeline-point-primary"></span>
                  <div class="timeline-event">
                    <div class="timeline-header mb-1">
                      <h6 class="mb-0">12 Invoices have been paid</h6>
                      <small class="text-muted">12 min ago</small>
                    </div>
                    <p class="mb-2">Invoices have been paid to the company</p>
                    <div class="d-flex">
                      <a href="javascript:void(0)" class="me-3">
                        <img src="/public/assets/img/icons/misc/pdf.png" alt="PDF image" width="15" class="me-2" />
                        <span class="fw-medium text-heading">invoices.pdf</span>
                      </a>
                    </div>
                  </div>
                </li>
                <li class="timeline-item timeline-item-transparent">
                  <span class="timeline-point timeline-point-primary"></span>
                  <div class="timeline-event">
                    <div class="timeline-header mb-1">
                      <h6 class="mb-0">12 Invoices have been paid</h6>
                      <small class="text-muted">12 min ago</small>
                    </div>
                    <p class="mb-2">Invoices have been paid to the company</p>
                    <div class="d-flex">
                      <a href="javascript:void(0)" class="me-3">
                        <img src="/public/assets/img/icons/misc/pdf.png" alt="PDF image" width="15" class="me-2" />
                        <span class="fw-medium text-heading">invoices.pdf</span>
                      </a>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="tab-pane fade" id="navs_stats" role="tabpanel">Estadísticas</div>
            <div class="tab-pane fade" id="navs_settings" role="tabpanel">
              <div class="row g-3">
                <div class="col-md-12">
                  <label for="TagifyCustomInlineSuggestion" class="form-label">Formato de código</label>
                  <input
                    id="TagifyCustomInlineSuggestion"
                    name="TagifyCustomInlineSuggestion"
                    class="form-control"
                    placeholder="Selecciona una opción o escribe un valor"
                    value="ID orden de compra, Número de parte, # Consecutivo de la pieza por OC" />
                </div>
                <div class="col-md-12">
                  <label for="select2Basic" class="form-label">Tipo de código</label>
                  <select id="select2Basic" class="select2 form-select" data-allow-clear="true">
                    <option value="QR">Código QR</option>
                    <option value="DM">Código DataMatrix</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--/ User Content -->
  </div>
</div>

<!-- Modal editar cliente -->
<div class="modal fade modal_cliente" id="modal_edit_client" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal_cliente" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar cliente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="edit-client-form" class="row g-3">
          <div class="col-md-7">
            <label for="nombre_cliente" class="form-label required">Nombre</label>
            <input type="text" id="nombre_cliente" name="nombre" class="form-control" />
          </div>
          <div class="col-md-5">
            <label for="rfc_cliente" class="form-label required">RFC o identificador</label>
            <input type="text" id="rfc_cliente" class="form-control" name="identificador" />
          </div>
          <div class="col-md-12">
            <label for="domicilio_cliente" class="form-label">Domicilio</label>
            <input type="text" id="domicilio_cliente" class="form-control" name="domicilio" />
          </div>
          <div class="col-md-6">
            <label for="pais_cliente" class="form-label">País</label>
            <input id="pais_cliente" class="form-control" name="pais" />
          </div>
          <div class="col-md-6">
            <label for="estado_cliente" class="form-label">Estado</label>
            <input id="estado_cliente" class="form-control" name="estado" />
          </div>
          <div class="col-md-6">
            <label for="ciudad_cliente" class="form-label">Ciudad</label>
            <input id="ciudad_cliente" class="form-control" name="ciudad" />
          </div>
          <div class="col-md-6">
            <label for="email_cliente" class="form-label">Correo electrónico</label>
            <input class="form-control" type="email" id="email_cliente" name="correo" />
          </div>
          <div class="col-md-6">
            <label for="telefono_cliente" class="form-label">Teléfono</label>
            <input class="form-control" type="tel" id="telefono_cliente" name="telefono" />
          </div>
          <div class="col-md-6">
            <label for="celular_cliente" class="form-label">Celular</label>
            <input class="form-control" type="tel" id="celular_cliente" name="celular" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="confirm_edit_client" type="submit" form="edit-client-form" class="btn btn-success">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!--! MODAL DELETE CLIENTE -->
<div class="modal fade" id="delete_client_modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel1">Eliminar cliente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12">
            <p>Esta acción es irreversible</p>
          </div>
        </div>
      </div>
      <div class="modal-footer d-block">
        <div class="d-flex justify-content-end">
          <button id="delete_client_btn" class="btn btn-danger">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--! MODAL ADD PIEZA -->
<div class="modal fade modal_cliente" id="modal_crear_pieza" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal_cliente" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Crear pieza</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="crear-pieza-form" class="row g-3">
          <div class="col-md-12">
            <label for="numero_parte" class="form-label required">Número de parte</label>
            <input type="text" id="numero_parte" name="numero_parte" class="form-control" />
          </div>
          <div class="col-md-12">
            <label for="descripcion" class="form-label required">Descripción</label>
            <input type="text" id="descripcion" name="descripcion" class="form-control" />
          </div>
          <div class="col-md-12">
            <label for="input-imgs" class="form-label required">Imágenes</label>
            <div id="dpz-imgs" class="fallback dropzone">
              <input id="input-imgs" type="file" multiple />
            </div>
          </div>
          <div class="col-md-12">
            <label for="input-files" class="form-label required">Archivos</label>
            <div id="dpz-files" class="fallback dropzone">
              <input id="input-files" type="file" multiple />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="confirm_edit_client" type="submit" form="crear-pieza-form" class="btn btn-success">Guardar</button>
      </div>
    </div>
  </div>
</div>
<!--!OFFCANVAS PIEZA-->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas_pieza" aria-labelledby="offcanvasEndLabel">
  <div class="offcanvas-header">
    <h5 id="offcanvas_pieza_title" class="offcanvas-title"></h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body mx-0 flex-grow-0">
    <button id="btn_edit_pieza" type="button" class="btn btn-primary mb-2 d-grid w-100">Editar general</button>
    <button
      id="btn_edit_revision"
      type="button"
      class="btn btn-label-secondary d-grid w-100"
      data-bs-dismiss="offcanvas">
      Editar revisión
    </button>
    <select id="select_revision" class="form-select mt-2">
      <option value="0">Revisión actual</option>
    </select>
    <button
      id="btn_new_revision"
      type="button"
      class="btn btn-label-secondary d-grid w-100"
      data-bs-dismiss="offcanvas">
      Nueva revisión
    </button>
  </div>
</div>

<script>
  var clientData = JSON.parse('<%- JSON.stringify(clientData) %>') ?? {};
  var piezasData = JSON.parse('<%- JSON.stringify(piezasData) %>') ?? [];
</script>

<script src="/public/scripts/clientes/cliente.js" type="module"></script>
<script src="/public/scripts/clientes/piezas.js" type="module"></script>
